import{_ as r,r as a,o as s,c as i,b as t,d as e,e as o,a as d}from"./app.4217e908.js";const l={},c=t("h1",{id:"continuous-integration-and-deployments",tabindex:"-1"},[t("a",{class:"header-anchor",href:"#continuous-integration-and-deployments","aria-hidden":"true"},"#"),e(" Continuous Integration and Deployments")],-1),h={href:"https://dev.azure.com/IVCPricingTool/Pricing%20Tool/_build?definitionId=2",target:"_blank",rel:"noopener noreferrer"},p=t("h2",{id:"builds",tabindex:"-1"},[t("a",{class:"header-anchor",href:"#builds","aria-hidden":"true"},"#"),e(" Builds")],-1),u=t("p",null,[e("The config files for the builds live in the "),t("a",{href:"../AzurePipelines"},"AzurePipelines"),e(" directory. There are two jobs that run depending on the branch, with one running on every commit to master and one that runs on all commits on every branch apart from master. Both jobs are the same, except that the master job packages everything up for deployment too.")],-1),m={href:"https://nuke.build/index.html",target:"_blank",rel:"noopener noreferrer"},f=t("code",null,"build.ps1",-1),b=d('<p>The build process creates a Docker container that contains an instance of SQL Server, which allows the tests to run against a database without needing to deploy to an environment.</p><h2 id="deployments" tabindex="-1"><a class="header-anchor" href="#deployments" aria-hidden="true">#</a> Deployments</h2><p>Azure Pipelines deploys artifacts built by the build pipeline for the <code>master</code> branch to the Azure environment as well as running the migrations against the Azure SQL database for that environment.</p><p>Deployments are promoted through the chain of environments:</p><p>Int -&gt; Test -&gt; UAT -&gt; Pre-prod (QA) -&gt; Production</p><p>Deployments to Int happen automatically once the build for the <code>master</code> branch has finished. Later environments require a manual approval to promote a deployment to that environment.</p><h3 id="deployment-network-security" tabindex="-1"><a class="header-anchor" href="#deployment-network-security" aria-hidden="true">#</a> Deployment network security</h3><p>As of September 2020, the App Service networking restrictions set up by the IVC infrastructure team lock down all traffic to the App Service&#39;s SCM deployment domain. The intention here is to prevent any public access to the server. Since we&#39;re currently using Microsoft&#39;s hosted Pipelines agents for deployments, this prevents the agents from connecting to the app service to perform the deploy.</p>',8),y={href:"https://docs.microsoft.com/en-us/azure/devops/pipelines/agents/v2-windows?view=azure-devops#check-prerequisites",target:"_blank",rel:"noopener noreferrer"},_=t("p",null,"As of September 2020, this is not yet set up. As a workaround, to perform a deploy, we need to contact Andrew Eliott on IVC's infrastructure team, and have him temporarily open up the SCM IPs while we run the deploy, before locking it back down again.",-1);function g(v,k){const n=a("ExternalLinkIcon");return s(),i("div",null,[c,t("p",null,[e("We use "),t("a",h,[e("Azure DevOps Pipelines"),o(n)]),e(" to automate builds and deployments.")]),p,u,t("p",null,[e("The build process calls the "),t("a",m,[e("Nuke"),o(n)]),e(" build script "),f,e(" to compile the code, run tests and package it all up as an artifact that can be used in the deployment (master only).")]),b,t("p",null,[e("The long term plan is for an on-prem VM to be set up, and used a "),t("a",y,[e("self-hosted agent"),o(n)]),e(".")]),_])}const A=r(l,[["render",g],["__file","BuildsAndDeployments.html.vue"]]);export{A as default};
